{% extends 'webapp/base.html' %}

{% block content %}
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.6.1.min.js"></script>

    <div class="card border-primary p-4 mb-4">

        <h2 class="text-center mb-4">Top Clients Analytics</h2>

        <div class="card bg-secondary mb-4">
            <div class="card-body">
                <h4 class="card-title">Filter by Spending:</h4>
                <form method="get">
                    <label class="me-2">Min Spend:</label>
                    <input type="number" class="form-control d-inline-block w-auto me-3" name="min_spend" value="{{ request.GET.min_spend|default:'' }}">
                    
                    <label class="me-2">Max Spend:</label>
                    <input type="number" class="form-control d-inline-block w-auto me-3" name="max_spend" value="{{ request.GET.max_spend|default:'' }}">
                    
                    <button type="submit" class="btn btn-primary">Filter Clients</button>
                </form>
            </div>
        </div>

        {% if stats_customers and stats_customers.mean %}
        <div class="card bg-secondary mb-4">
            <div class="card-body">
                <h4 class="card-title">Customer Spending Stats:</h4>
                <p><strong>Average Spend:</strong> {{ stats_customers.mean|floatformat:2 }}</p>
                <p><strong>Min Spend:</strong> {{ stats_customers.min|floatformat:2 }}</p>
                <p><strong>Max Spend:</strong> {{ stats_customers.max|floatformat:2 }}</p>
                <p><strong>Median Spend:</strong> {{ stats_customers.median|floatformat:2 }}</p>
            </div>
        </div>
        {% endif %}

        <div class="mb-4 text-center">
            {{ html_customers|safe }}
        </div>

        {% if bokeh_div %}
        <div class="card border-info p-3">
            <h2 class="text-center">Sold Tickets (Bokeh)</h2>
            {{ bokeh_div|safe }}
            {{ bokeh_script|safe }}
        </div>
        {% endif %}

    </div>
{% endblock %}